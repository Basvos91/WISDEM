
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>towerse.tower &#8212; TowerSE 0.1.4 documentation</title>
    <link rel="stylesheet" href="../../_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TowerSE 0.1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for towerse.tower</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">towerstruc.py</span>

<span class="sd">Created by Andrew Ning on 2012-01-20.</span>
<span class="sd">Copyright (c) NREL. All rights reserved.</span>

<span class="sd">HISTORY:  2012 created</span>
<span class="sd">          -7/2014:  R.D. Bugs found in the call to shellBucklingEurocode from towerwithFrame3DD. Fixed.</span>
<span class="sd">                    Also set_as_top added.</span>
<span class="sd">          -10/2014: R.D. Merged back with some changes Andrew did on his end.</span>
<span class="sd">          -12/2014: A.N. fixed some errors from the merge (redundant drag calc).  pep8 compliance.  removed several unneccesary variables and imports (including set_as_top)</span>
<span class="sd">          - 6/2015: A.N. major rewrite.  removed pBEAM.  can add spring stiffness anywhere.  can add mass anywhere.</span>
<span class="sd">            can use different material props throughout.</span>
<span class="sd">          - 7/2015 : R.D. modified to use commonse modules.</span>
<span class="sd">          - 1/2018 : G.B. modified for easier use with other modules, reducing user input burden, and shifting more to commonse</span>
<span class="sd"> &quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">openmdao.api</span> <span class="k">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Problem</span><span class="p">,</span> <span class="n">IndepVarComp</span>

<span class="kn">from</span> <span class="nn">commonse.WindWaveDrag</span> <span class="k">import</span> <span class="n">AeroHydroLoads</span><span class="p">,</span> <span class="n">CylinderWindDrag</span><span class="p">,</span> <span class="n">CylinderWaveDrag</span>

<span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="k">import</span> <span class="n">WindBase</span><span class="p">,</span> <span class="n">WaveBase</span><span class="p">,</span> <span class="n">LinearWaves</span><span class="p">,</span> <span class="n">TowerSoil</span><span class="p">,</span> <span class="n">PowerWind</span><span class="p">,</span> <span class="n">LogWind</span>
<span class="kn">from</span> <span class="nn">commonse.tube</span> <span class="k">import</span> <span class="n">CylindricalShellProperties</span>
<span class="kn">from</span> <span class="nn">commonse.utilities</span> <span class="k">import</span> <span class="n">assembleI</span><span class="p">,</span> <span class="n">unassembleI</span>
<span class="kn">from</span> <span class="nn">commonse</span> <span class="k">import</span> <span class="n">gravity</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">NFREQ</span>

<span class="kn">from</span> <span class="nn">commonse.vertical_cylinder</span> <span class="k">import</span> <span class="n">CylinderDiscretization</span><span class="p">,</span> <span class="n">CylinderMass</span><span class="p">,</span> <span class="n">CylinderFrame3DD</span>
<span class="c1">#from fusedwind.turbine.tower import TowerFromCSProps</span>
<span class="c1">#from fusedwind.interface import implement_base</span>

<span class="kn">import</span> <span class="nn">commonse.UtilizationSupplement</span> <span class="k">as</span> <span class="nn">Util</span>


<span class="c1"># -----------------</span>
<span class="c1">#  Components</span>
<span class="c1"># -----------------</span>

<span class="k">class</span> <span class="nc">TowerDiscretization</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerDiscretization</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;diameter at tower base&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;z_end&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Last node point on tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;height_constraint&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mismatch between tower height and desired hub_height&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;height_constraint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;z_end&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;height_constraint&#39;</span><span class="p">,</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;height_constraint&#39;</span><span class="p">,</span><span class="s1">&#39;z_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">J</span>
        
<span class="k">class</span> <span class="nc">TowerMass</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nPoints</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerMass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total cylinder mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;cylinder_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of mass of cylinder&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z position of center of mass of each can in the cylinder&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of cylinder about base [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total tower mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of mass of tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_section_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z position of center of mass of each can in the tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of tower about base [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cylinder_center_of_mass&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_section_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">])</span>
        <span class="n">zeroPts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
        <span class="n">zero6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">]))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeroPts</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zero6</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeroPts</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zero6</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_section_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_section_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_section_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_section_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npts</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_section_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="n">npts</span><span class="p">))</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cylinder_I_base&#39;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">J</span>
        
        
<span class="k">class</span> <span class="nc">TurbineMass</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TurbineMass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;hubH&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Hub-height&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total tower mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_I&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of rna about tower top [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_cg&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xyz-location of rna cg relative to tower top&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total tower mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-position of center of mass of tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of tower about base [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;turbine_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total mass of tower+rna&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;turbine_center_of_mass&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xyz-position of tower+rna center of mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;turbine_I_base&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia of tower about base [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>
       
        <span class="c1"># Derivatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>
        
    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;turbine_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">]</span>
        
        <span class="n">cg_rna</span>   <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_cg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hubH&#39;</span><span class="p">]])</span>
        <span class="n">cg_tower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">]])</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;turbine_center_of_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">cg_rna</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">cg_tower</span><span class="p">)</span> <span class="o">/</span> <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;turbine_mass&#39;</span><span class="p">]</span>

        <span class="n">R</span> <span class="o">=</span> <span class="n">cg_rna</span>
        <span class="n">I_tower</span> <span class="o">=</span> <span class="n">assembleI</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">])</span>
        <span class="n">I_rna</span>   <span class="o">=</span> <span class="n">assembleI</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_I&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;turbine_I_base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unassembleI</span><span class="p">(</span><span class="n">I_tower</span> <span class="o">+</span> <span class="n">I_rna</span><span class="p">)</span>
        
    

<span class="k">class</span> <span class="nc">TowerPreFrame</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nFull</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerPreFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location along tower. start at bottom and go to top&#39;</span><span class="p">)</span>

        <span class="c1"># extra mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;added mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mI&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;mass moment of inertia about some point p [xx yy zz xy xz yz]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;mrho&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xyz-location of p relative to node&#39;</span><span class="p">)</span>

        <span class="c1"># point loads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_F&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rna force&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;rna_M&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,)),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;rna moment&#39;</span><span class="p">)</span>

        <span class="c1"># Monopile handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;k_monopile&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Stiffness BCs for ocean soil.  Only used if monoflag inputis True&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;monopile&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Flag for monopile BCs&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># spring reaction data.  Use float(&#39;inf&#39;) for rigid constraints.</span>
        <span class="n">nK</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;kidx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;indices of z where external stiffness reactions should be applied.&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;kx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;spring stiffness in x-direction&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;ky&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;spring stiffness in y-direction&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;kz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;spring stiffness in z-direction&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;ktx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;spring stiffness in theta_x-rotation&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;kty&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;spring stiffness in theta_y-rotation&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;ktz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nK</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;spring stiffness in theta_z-rotation&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># extra mass</span>
        <span class="n">nMass</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;midx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;indices where added mass should be applied.&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;added mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mIxx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x mass moment of inertia about some point p&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mIyy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y mass moment of inertia about some point p&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mIzz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z mass moment of inertia about some point p&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mIxy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xy mass moment of inertia about some point p&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mIxz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;xz mass moment of inertia about some point p&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mIyz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;yz mass moment of inertia about some point p&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mrhox&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;x-location of p relative to node&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mrhoy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;y-location of p relative to node&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;mrhoz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nMass</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;z-location of p relative to node&#39;</span><span class="p">)</span>

        <span class="c1"># point loads (if addGravityLoadForExtraMass=True be sure not to double count by adding those force here also)</span>
        <span class="n">nPL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;plidx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;indices where point loads should be applied.&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;point force in x-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;point force in y-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Fz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;point force in z-direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mxx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;point moment about x-axis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Myy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;point moment about y-axis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;Mzz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPL</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;point moment about z-axis&#39;</span><span class="p">)</span>

        
    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="c1"># Prepare for reactions: rigid at tower base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kidx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">0</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;monopile&#39;</span><span class="p">]:</span>
            <span class="n">kmono</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;k_monopile&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kx&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">kmono</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;ky&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">kmono</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kz&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">kmono</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;ktx&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">kmono</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kty&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">kmono</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;ktz&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">kmono</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kx&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;ky&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kz&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;ktx&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;kty&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;ktz&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">])</span>
            
        <span class="c1"># Prepare RNA for &quot;extra node mass&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;midx&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mIxx&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mI&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mIyy&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mI&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mIzz&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mI&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mIxy&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mI&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mIxz&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mI&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mIyz&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mI&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mrhox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mrho&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mrhoy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mrho&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;mrhoz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mrho&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>

        <span class="c1"># Prepare point forces at RNA node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;plidx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Fx&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_F&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_F&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Fz&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_F&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mxx&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_M&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Myy&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_M&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;Mzz&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;rna_M&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="p">])</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span> <span class="s1">&#39;mI&#39;</span><span class="p">,</span> <span class="s1">&#39;mrho&#39;</span><span class="p">,</span> <span class="s1">&#39;rna_F&#39;</span><span class="p">,</span> <span class="s1">&#39;rna_M&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;mIxx&#39;</span><span class="p">,</span> <span class="s1">&#39;mIyy&#39;</span><span class="p">,</span> <span class="s1">&#39;mIzz&#39;</span><span class="p">,</span> <span class="s1">&#39;mIxy&#39;</span><span class="p">,</span> <span class="s1">&#39;mIxz&#39;</span><span class="p">,</span> <span class="s1">&#39;mIyz&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fz&#39;</span><span class="p">,</span> <span class="s1">&#39;Mxx&#39;</span><span class="p">,</span> <span class="s1">&#39;Myy&#39;</span><span class="p">,</span> <span class="s1">&#39;Mzz&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>
        
    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="n">J</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">inp</span><span class="p">,</span><span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_deriv_vars</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">:</span>
                <span class="n">J</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unknowns</span><span class="p">[</span><span class="n">o</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">)</span>
                
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mIxx&#39;</span><span class="p">,</span><span class="s1">&#39;mI&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mIyy&#39;</span><span class="p">,</span><span class="s1">&#39;mI&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mIzz&#39;</span><span class="p">,</span><span class="s1">&#39;mI&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mIxy&#39;</span><span class="p">,</span><span class="s1">&#39;mI&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">3</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mIxz&#39;</span><span class="p">,</span><span class="s1">&#39;mI&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">4</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;mIyz&#39;</span><span class="p">,</span><span class="s1">&#39;mI&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">)[</span><span class="mi">5</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Fx&#39;</span><span class="p">,</span><span class="s1">&#39;rna_F&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span><span class="s1">&#39;rna_F&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Fz&#39;</span><span class="p">,</span><span class="s1">&#39;rna_F&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mxx&#39;</span><span class="p">,</span><span class="s1">&#39;rna_M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Myy&#39;</span><span class="p">,</span><span class="s1">&#39;rna_M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">J</span><span class="p">[</span><span class="s1">&#39;Mzz&#39;</span><span class="p">,</span><span class="s1">&#39;rna_M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">2</span><span class="p">,:]</span>

        
<span class="k">class</span> <span class="nc">TowerPostFrame</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nFull</span><span class="p">,</span> <span class="n">nDEL</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerPostFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># effective geometry -- used for handbook methods to estimate hoop stress, buckling, fatigue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;location along tower. start at bottom and go to top&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;effective tower diameter for section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;effective shell thickness for section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;L_reinforced&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;buckling length&#39;</span><span class="p">)</span>

        <span class="c1"># Material properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;modulus of elasticity&#39;</span><span class="p">)</span>

        <span class="c1"># Processed Frame3DD outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Fz&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Axial foce in vertical z-direction in cylinder structure.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Mxx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Moment about x-axis in cylinder structure.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;Myy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Moment about y-axis in cylinder structure.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;axial_stress&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;axial stress in tower elements&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;shear_stress&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;shear stress in tower elements&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;hoop_stress&#39;</span> <span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;hoop stress in tower elements&#39;</span><span class="p">)</span>

        <span class="c1"># safety factors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on loads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on materials&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_n&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;safety factor on consequence of failure&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_b&#39;</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;buckling safety factor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N/m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;yield stress&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">,</span> <span class="mf">1.755</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;total safety factor for fatigue&#39;</span><span class="p">)</span>

        <span class="c1"># fatigue parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;life&#39;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue life of tower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;m_SN&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;slope of S/N curve&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;DC&#39;</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;standard value of stress&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;z_DEL&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nDEL</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;absolute z coordinates of corresponding fatigue parameters&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;M_DEL&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nDEL</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;fatigue parameters at corresponding z coordinates&#39;</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;First natural frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Second natural frequency&#39;</span><span class="p">)</span>
        
        <span class="c1"># outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;First and second natural frequency&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;top_deflection&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Deflection of tower top in yaw-aligned +x direction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;stress&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Von Mises stress utilization along tower at specified locations.  incudes safety factor.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;shell_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Shell buckling constraint.  Should be &lt; 1 for feasibility.  Includes safety factors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;global_buckling&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Global buckling constraint.  Should be &lt; 1 for feasibility.  Includes safety factors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;damage&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Fatigue damage at each tower section&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;turbine_F&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total force on tower+rna&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s1">&#39;turbine_M&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Total x-moment on tower+rna measured at base&#39;</span><span class="p">)</span>
        
        <span class="c1"># Derivatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>

        
    <span class="k">def</span> <span class="nf">solve_nonlinear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">,</span> <span class="n">resids</span><span class="p">):</span>
        <span class="c1"># Unpack some variables</span>
        <span class="n">axial_stress</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;axial_stress&#39;</span><span class="p">]</span>
        <span class="n">shear_stress</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;shear_stress&#39;</span><span class="p">]</span>
        <span class="n">hoop_stress</span>  <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;hoop_stress&#39;</span><span class="p">]</span>
        <span class="n">sigma_y</span>      <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">axial_stress</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">E</span>            <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">axial_stress</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">L_reinforced</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;L_reinforced&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">axial_stress</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Frequencies</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NFREQ</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;structural_frequencies&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span>
        
        <span class="c1"># von mises stress</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Util</span><span class="o">.</span><span class="n">vonMisesStressUtilization</span><span class="p">(</span><span class="n">axial_stress</span><span class="p">,</span> <span class="n">hoop_stress</span><span class="p">,</span> <span class="n">shear_stress</span><span class="p">,</span>
                      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_n&#39;</span><span class="p">],</span> <span class="n">sigma_y</span><span class="p">)</span>

        <span class="c1"># shell buckling</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;shell_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Util</span><span class="o">.</span><span class="n">shellBucklingEurocode</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">axial_stress</span><span class="p">,</span> <span class="n">hoop_stress</span><span class="p">,</span>
                                                                <span class="n">shear_stress</span><span class="p">,</span> <span class="n">L_reinforced</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_b&#39;</span><span class="p">])</span>

        <span class="c1"># global buckling</span>
        <span class="n">tower_height</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mxx&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Myy&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;global_buckling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Util</span><span class="o">.</span><span class="n">bucklingGL</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fz&#39;</span><span class="p">],</span> <span class="n">M</span><span class="p">,</span> <span class="n">tower_height</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span>
                                                      <span class="n">sigma_y</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_b&#39;</span><span class="p">])</span>

        <span class="c1"># fatigue</span>
        <span class="n">N_DEL</span> <span class="o">=</span> <span class="mf">365.0</span><span class="o">*</span><span class="mf">24.0</span><span class="o">*</span><span class="mf">3600.0</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;life&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]))</span>
        <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_DEL</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;M_DEL&#39;</span><span class="p">]):</span>
            <span class="n">M_DEL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;z_DEL&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;M_DEL&#39;</span><span class="p">])</span>

            <span class="n">unknowns</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Util</span><span class="o">.</span><span class="n">fatigue</span><span class="p">(</span><span class="n">M_DEL</span><span class="p">,</span> <span class="n">N_DEL</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;m_SN&#39;</span><span class="p">],</span>
                                              <span class="n">params</span><span class="p">[</span><span class="s1">&#39;DC&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">],</span> <span class="n">stress_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">weld_factor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># -----------------</span>
<span class="c1">#  Assembly</span>
<span class="c1"># -----------------</span>

<span class="k">class</span> <span class="nc">TowerLeanSE</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nPoints</span><span class="p">,</span> <span class="n">nFull</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TowerLeanSE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="n">nRefine</span> <span class="o">=</span> <span class="p">(</span><span class="n">nFull</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Independent variables that are unique to TowerSE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_section_height&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_section_height&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_outer_diameter&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_outer_diameter&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPoints</span><span class="p">)),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_wall_thickness&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_wall_thickness&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPoints</span><span class="p">)),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_outfitting_factor&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_outfitting_factor&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_buckling_length&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_buckling_length&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># All the static components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">CylinderDiscretization</span><span class="p">(</span><span class="n">nPoints</span><span class="p">,</span> <span class="n">nRefine</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tgeometry&#39;</span><span class="p">,</span> <span class="n">TowerDiscretization</span><span class="p">(),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span><span class="s1">&#39;height_constraint&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">,</span> <span class="n">CylinderMass</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;material_density&#39;</span><span class="p">,</span><span class="s1">&#39;z_full&#39;</span><span class="p">,</span><span class="s1">&#39;d_full&#39;</span><span class="p">,</span><span class="s1">&#39;t_full&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tm&#39;</span><span class="p">,</span> <span class="n">TowerMass</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;gc&#39;</span><span class="p">,</span> <span class="n">Util</span><span class="o">.</span><span class="n">GeometricConstraints</span><span class="p">(</span><span class="n">nPoints</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min_d_to_t&#39;</span><span class="p">,</span><span class="s1">&#39;max_taper&#39;</span><span class="p">,</span><span class="s1">&#39;manufacturability&#39;</span><span class="p">,</span><span class="s1">&#39;weldability&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;turb&#39;</span><span class="p">,</span> <span class="n">TurbineMass</span><span class="p">(),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;turbine_mass&#39;</span><span class="p">,</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;rna_cg&#39;</span><span class="p">,</span> <span class="s1">&#39;rna_I&#39;</span><span class="p">])</span>

        <span class="c1"># Connections for geometry and mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_section_height&#39;</span><span class="p">,</span> <span class="s1">&#39;section_height&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_outer_diameter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;diameter&#39;</span><span class="p">,</span> <span class="s1">&#39;gc.d&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_wall_thickness&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;wall_thickness&#39;</span><span class="p">,</span> <span class="s1">&#39;gc.t&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_outfitting_factor&#39;</span><span class="p">,</span> <span class="s1">&#39;cm.outfitting_factor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;z_param&#39;</span><span class="p">,</span> <span class="s1">&#39;tgeometry.z_end&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;hub_height&#39;</span><span class="p">,</span> <span class="s1">&#39;turb.hubH&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;cm.mass&#39;</span><span class="p">,</span> <span class="s1">&#39;tm.cylinder_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;cm.center_of_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;tm.cylinder_center_of_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;cm.section_center_of_mass&#39;</span><span class="p">,</span><span class="s1">&#39;tm.cylinder_section_center_of_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;cm.I_base&#39;</span><span class="p">,</span><span class="s1">&#39;tm.cylinder_I_base&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;turb.tower_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;turb.tower_center_of_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_I_base&#39;</span><span class="p">,</span> <span class="s1">&#39;turb.tower_I_base&#39;</span><span class="p">)</span>

        
<div class="viewcode-block" id="TowerSE"><a class="viewcode-back" href="../../documentation.html#towerse.tower.TowerSE">[docs]</a><span class="k">class</span> <span class="nc">TowerSE</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nLC</span><span class="p">,</span> <span class="n">nPoints</span><span class="p">,</span> <span class="n">nFull</span><span class="p">,</span> <span class="n">nDEL</span><span class="p">,</span> <span class="n">wind</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">TowerSE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1"># Independent variables that are unique to TowerSE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_M_DEL&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_M_DEL&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nDEL</span><span class="p">),</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_z_DEL&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_z_DEL&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nDEL</span><span class="p">),</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_add_gravity&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_add_gravity&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower_force_discretization&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;tower_force_discretization&#39;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;monopile&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;monopile&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pass_by_obj</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;suctionpile_depth&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;suctionpile_depth&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;soil_G&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;soil_G&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;soil_nu&#39;</span><span class="p">,</span> <span class="n">IndepVarComp</span><span class="p">(</span><span class="s1">&#39;soil_nu&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;geom&#39;</span><span class="p">,</span> <span class="n">TowerLeanSE</span><span class="p">(</span><span class="n">nPoints</span><span class="p">,</span> <span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;props&#39;</span><span class="p">,</span> <span class="n">CylindricalShellProperties</span><span class="p">(</span><span class="n">nFull</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;soil&#39;</span><span class="p">,</span> <span class="n">TowerSoil</span><span class="p">())</span>

        <span class="c1"># Connections for geometry and mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;d_full&#39;</span><span class="p">,</span> <span class="s1">&#39;props.d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;t_full&#39;</span><span class="p">,</span> <span class="s1">&#39;props.t&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;d_full&#39;</span><span class="p">,</span> <span class="s1">&#39;soil.d0&#39;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;suctionpile_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;soil.depth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;soil_G&#39;</span><span class="p">,</span> <span class="s1">&#39;soil.G&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;soil_nu&#39;</span><span class="p">,</span> <span class="s1">&#39;soil.nu&#39;</span><span class="p">)</span>
        
        <span class="c1"># Add in all Components that drive load cases</span>
        <span class="c1"># Note multiple load cases have to be handled by replicating components and not groups/assemblies.</span>
        <span class="c1"># Replicating Groups replicates the IndepVarComps which doesn&#39;t play nicely in OpenMDAO</span>
        <span class="k">for</span> <span class="n">iLC</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nLC</span><span class="p">):</span>
            <span class="n">lc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">nLC</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">iLC</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">wind</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;powerwind&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;wind&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">PowerWind</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">wind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;logwind&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;wind&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">LogWind</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown wind type, &#39;</span><span class="o">+</span><span class="n">wind</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;wave&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">LinearWaves</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z_floor&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">CylinderWindDrag</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cd_usr&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">CylinderWaveDrag</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cm&#39;</span><span class="p">,</span><span class="s1">&#39;cd_usr&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">AeroHydroLoads</span><span class="p">(</span><span class="n">nFull</span><span class="p">))</span><span class="c1">#, promotes=[&#39;yaw&#39;])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">TowerPreFrame</span><span class="p">(</span><span class="n">nFull</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;monopile&#39;</span><span class="p">,</span><span class="s1">&#39;k_monopile&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">CylinderFrame3DD</span><span class="p">(</span><span class="n">nFull</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="s1">&#39;tol&#39;</span><span class="p">,</span><span class="s1">&#39;Mmethod&#39;</span><span class="p">,</span><span class="s1">&#39;geom&#39;</span><span class="p">,</span><span class="s1">&#39;lump&#39;</span><span class="p">,</span><span class="s1">&#39;shear&#39;</span><span class="p">,</span>
                                                                             <span class="s1">&#39;nM&#39;</span><span class="p">,</span><span class="s1">&#39;shift&#39;</span><span class="p">,</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="p">,</span> <span class="n">TowerPostFrame</span><span class="p">(</span><span class="n">nFull</span><span class="p">,</span> <span class="n">nDEL</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">,</span><span class="s1">&#39;DC&#39;</span><span class="p">,</span><span class="s1">&#39;life&#39;</span><span class="p">,</span><span class="s1">&#39;m_SN&#39;</span><span class="p">,</span>
                                                                      <span class="s1">&#39;gamma_b&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">,</span><span class="s1">&#39;gamma_n&#39;</span><span class="p">])</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;z_full&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;wind&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;d_full&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.d&#39;</span><span class="p">,</span> <span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.d&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.d&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.d&#39;</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mass&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;rna_cg&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrho&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;rna_I&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mI&#39;</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;material_density&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.rho&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kidx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kidx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.ky&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.ky&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.ktx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.ktx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kty&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.kty&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.ktz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.ktz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.midx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.midx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.m&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.m&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIxx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIxx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIyy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIyy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIzz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIzz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIxy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIxy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIxz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIxz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIyz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mIyz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrhox&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrhox&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrhoy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrhoy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrhoz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.mrhoz&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.plidx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.plidx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Mxx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Mxx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Myy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Myy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Mzz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Mzz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_force_discretization&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.dx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_add_gravity&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.addGravityLoadForExtraMass&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;t_full&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.t&#39;</span><span class="p">,</span><span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.t&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;soil.k&#39;</span><span class="p">,</span> <span class="s1">&#39;k_monopile&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.f1&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.f1&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.f2&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.f2&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fz_out&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Fz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Mxx_out&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Mxx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Myy_out&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Myy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.axial_stress&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.axial_stress&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.shear_stress&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.shear_stress&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.hoop_stress_euro&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.hoop_stress&#39;</span><span class="p">)</span>
        
            <span class="c1"># connections to wind1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;z0&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z_surface&#39;</span><span class="p">)</span>
            <span class="c1">#self.connect(&#39;z_floor&#39;, &#39;waveLoads&#39;+lc+&#39;.wlevel&#39;)</span>

            <span class="c1"># connections to windLoads1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wind&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.U&#39;</span><span class="p">,</span> <span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.U&#39;</span><span class="p">)</span>
            <span class="c1">#self.connect(&#39;wind&#39;+lc+&#39;.beta&#39;, &#39;windLoads&#39;+lc+&#39;.beta&#39;)</span>

            <span class="c1"># connections to waveLoads1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wave&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.U&#39;</span><span class="p">,</span> <span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.U&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wave&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.A&#39;</span><span class="p">,</span> <span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.A&#39;</span><span class="p">)</span>
            <span class="c1">#self.connect(&#39;wave&#39;+lc+&#39;.beta&#39;, &#39;waveLoads&#39;+lc+&#39;.beta&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;wave&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.p&#39;</span><span class="p">,</span> <span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.p&#39;</span><span class="p">)</span>

            <span class="c1"># connections to distLoads1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_Px&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_Py&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_Pz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_qdyn&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_qdyn&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_beta&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_beta&#39;</span><span class="p">)</span>
            <span class="c1">#self.connect(&#39;windLoads&#39;+lc+&#39;.windLoads_Px0&#39;, &#39;distLoads&#39;+lc+&#39;.windLoads_Px0&#39;)</span>
            <span class="c1">#self.connect(&#39;windLoads&#39;+lc+&#39;.windLoads_Py0&#39;, &#39;distLoads&#39;+lc+&#39;.windLoads_Py0&#39;)</span>
            <span class="c1">#self.connect(&#39;windLoads&#39;+lc+&#39;.windLoads_Pz0&#39;, &#39;distLoads&#39;+lc+&#39;.windLoads_Pz0&#39;)</span>
            <span class="c1">#self.connect(&#39;windLoads&#39;+lc+&#39;.windLoads_qdyn0&#39;, &#39;distLoads&#39;+lc+&#39;.windLoads_qdyn0&#39;)</span>
            <span class="c1">#self.connect(&#39;windLoads&#39;+lc+&#39;.windLoads_beta0&#39;, &#39;distLoads&#39;+lc+&#39;.windLoads_beta0&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_z&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;windLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_d&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.windLoads_d&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_Px&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_Px&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_Py&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_Py&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_Pz&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_Pz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_pt&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_qdyn&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_beta&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_beta&#39;</span><span class="p">)</span>
            <span class="c1">#self.connect(&#39;waveLoads&#39;+lc+&#39;.waveLoads_Px0&#39;, &#39;distLoads&#39;+lc+&#39;.waveLoads_Px0&#39;)</span>
            <span class="c1">#self.connect(&#39;waveLoads&#39;+lc+&#39;.waveLoads_Py0&#39;, &#39;distLoads&#39;+lc+&#39;.waveLoads_Py0&#39;)</span>
            <span class="c1">#self.connect(&#39;waveLoads&#39;+lc+&#39;.waveLoads_Pz0&#39;, &#39;distLoads&#39;+lc+&#39;.waveLoads_Pz0&#39;)</span>
            <span class="c1">#self.connect(&#39;waveLoads&#39;+lc+&#39;.waveLoads_qdyn0&#39;, &#39;distLoads&#39;+lc+&#39;.waveLoads_qdyn0&#39;)</span>
            <span class="c1">#self.connect(&#39;waveLoads&#39;+lc+&#39;.waveLoads_beta0&#39;, &#39;distLoads&#39;+lc+&#39;.waveLoads_beta0&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_z&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;waveLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_d&#39;</span><span class="p">,</span> <span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.waveLoads_d&#39;</span><span class="p">)</span>

            <span class="c1"># Tower connections</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_buckling_length&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.L_reinforced&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.L_reinforced&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_M_DEL&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.M_DEL&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;tower_z_DEL&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.z_DEL&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;props.Az&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Az&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;props.Asx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Asx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;props.Asy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Asy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;props.Jz&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Jz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;props.Ixx&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Ixx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;props.Iyy&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Iyy&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Px&#39;</span><span class="p">,</span>   <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Px&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Py&#39;</span><span class="p">,</span>   <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Py&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Pz&#39;</span><span class="p">,</span>   <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.Pz&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;distLoads&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.qdyn&#39;</span><span class="p">,</span> <span class="s1">&#39;tower&#39;</span><span class="o">+</span><span class="n">lc</span><span class="o">+</span><span class="s1">&#39;.qdyn&#39;</span><span class="p">)</span>

        <span class="c1"># Derivatives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fd&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;central&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_calc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relative&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deriv_options</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span></div>

        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># --- tower setup ------</span>
    <span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="k">import</span> <span class="n">PowerWind</span>
    <span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="k">import</span> <span class="n">LogWind</span>

    <span class="c1"># --- geometry ----</span>
    <span class="n">h_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">43.8</span><span class="p">,</span> <span class="mf">87.6</span><span class="p">]))</span>
    <span class="n">d_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.935</span><span class="p">,</span> <span class="mf">3.87</span><span class="p">])</span>
    <span class="n">t_param</span> <span class="o">=</span> <span class="mf">1.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.027</span><span class="p">,</span> <span class="mf">0.023</span><span class="p">,</span> <span class="mf">0.019</span><span class="p">])</span>
    <span class="n">z_foundation</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">L_reinforced</span> <span class="o">=</span> <span class="mf">30.0</span>  <span class="c1"># [m] buckling length</span>
    <span class="n">theta_stress</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Koutfitting</span> <span class="o">=</span> <span class="mf">1.07</span>

    <span class="c1"># --- material props ---</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mf">210e9</span>
    <span class="n">G</span> <span class="o">=</span> <span class="mf">80.8e9</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="mf">8500.0</span>
    <span class="n">sigma_y</span> <span class="o">=</span> <span class="mf">450.0e6</span>

    <span class="c1"># --- extra mass ----</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">285598.8</span><span class="p">])</span>
    <span class="n">mIxx</span> <span class="o">=</span> <span class="mf">1.14930678e+08</span>
    <span class="n">mIyy</span> <span class="o">=</span> <span class="mf">2.20354030e+07</span>
    <span class="n">mIzz</span> <span class="o">=</span> <span class="mf">1.87597425e+07</span>
    <span class="n">mIxy</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">mIxz</span> <span class="o">=</span> <span class="mf">5.03710467e+05</span>
    <span class="n">mIyz</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">mI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mIxx</span><span class="p">,</span> <span class="n">mIyy</span><span class="p">,</span> <span class="n">mIzz</span><span class="p">,</span> <span class="n">mIxy</span><span class="p">,</span> <span class="n">mIxz</span><span class="p">,</span> <span class="n">mIyz</span><span class="p">])</span>
    <span class="n">mrho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.13197635</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.50875268</span><span class="p">])</span>
    <span class="c1"># -----------</span>

    <span class="c1"># --- wind ---</span>
    <span class="n">wind_zref</span> <span class="o">=</span> <span class="mf">90.0</span>
    <span class="n">wind_z0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">cd_usr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># ---------------</span>

    <span class="c1"># --- wave ---</span>
    <span class="n">hmax</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">monopile</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">suction_depth</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">soilG</span> <span class="o">=</span> <span class="mf">140e6</span>
    <span class="n">soilnu</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="c1"># ---------------</span>

    
    <span class="c1"># two load cases.  TODO: use a case iterator</span>
    
    <span class="c1"># # --- loading case 1: max Thrust ---</span>
    <span class="n">wind_Uref1</span> <span class="o">=</span> <span class="mf">11.73732</span>
    <span class="n">Fx1</span> <span class="o">=</span> <span class="mf">1284744.19620519</span>
    <span class="n">Fy1</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Fz1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2914124.84400512</span>
    <span class="n">Mxx1</span> <span class="o">=</span> <span class="mf">3963732.76208099</span>
    <span class="n">Myy1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2275104.79420872</span>
    <span class="n">Mzz1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">346781.68192839</span>
    <span class="c1"># # ---------------</span>

    <span class="c1"># # --- loading case 2: max wind speed ---</span>
    <span class="n">wind_Uref2</span> <span class="o">=</span> <span class="mf">70.0</span>
    <span class="n">Fx2</span> <span class="o">=</span> <span class="mf">930198.60063279</span>
    <span class="n">Fy2</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Fz2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2883106.12368949</span>
    <span class="n">Mxx2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1683669.22411597</span>
    <span class="n">Myy2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2522475.34625363</span>
    <span class="n">Mzz2</span> <span class="o">=</span> <span class="mf">147301.97023764</span>
    <span class="c1"># # ---------------</span>

    <span class="c1"># --- safety factors ---</span>
    <span class="n">gamma_f</span> <span class="o">=</span> <span class="mf">1.35</span>
    <span class="n">gamma_m</span> <span class="o">=</span> <span class="mf">1.3</span>
    <span class="n">gamma_n</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">gamma_b</span> <span class="o">=</span> <span class="mf">1.1</span>
    <span class="c1"># ---------------</span>

    <span class="c1"># --- fatigue ---</span>
    <span class="n">z_DEL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">1.327</span><span class="p">,</span> <span class="mf">3.982</span><span class="p">,</span> <span class="mf">6.636</span><span class="p">,</span> <span class="mf">9.291</span><span class="p">,</span> <span class="mf">11.945</span><span class="p">,</span> <span class="mf">14.600</span><span class="p">,</span> <span class="mf">17.255</span><span class="p">,</span> <span class="mf">19.909</span><span class="p">,</span> <span class="mf">22.564</span><span class="p">,</span> <span class="mf">25.218</span><span class="p">,</span> <span class="mf">27.873</span><span class="p">,</span> <span class="mf">30.527</span><span class="p">,</span> <span class="mf">33.182</span><span class="p">,</span> <span class="mf">35.836</span><span class="p">,</span> <span class="mf">38.491</span><span class="p">,</span> <span class="mf">41.145</span><span class="p">,</span> <span class="mf">43.800</span><span class="p">,</span> <span class="mf">46.455</span><span class="p">,</span> <span class="mf">49.109</span><span class="p">,</span> <span class="mf">51.764</span><span class="p">,</span> <span class="mf">54.418</span><span class="p">,</span> <span class="mf">57.073</span><span class="p">,</span> <span class="mf">59.727</span><span class="p">,</span> <span class="mf">62.382</span><span class="p">,</span> <span class="mf">65.036</span><span class="p">,</span> <span class="mf">67.691</span><span class="p">,</span> <span class="mf">70.345</span><span class="p">,</span> <span class="mf">73.000</span><span class="p">,</span> <span class="mf">75.655</span><span class="p">,</span> <span class="mf">78.309</span><span class="p">,</span> <span class="mf">80.964</span><span class="p">,</span> <span class="mf">83.618</span><span class="p">,</span> <span class="mf">86.273</span><span class="p">,</span> <span class="mf">87.600</span><span class="p">])</span>
    <span class="n">M_DEL</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.2940E+003</span><span class="p">,</span> <span class="mf">8.1518E+003</span><span class="p">,</span> <span class="mf">7.8831E+003</span><span class="p">,</span> <span class="mf">7.6099E+003</span><span class="p">,</span> <span class="mf">7.3359E+003</span><span class="p">,</span> <span class="mf">7.0577E+003</span><span class="p">,</span> <span class="mf">6.7821E+003</span><span class="p">,</span> <span class="mf">6.5119E+003</span><span class="p">,</span> <span class="mf">6.2391E+003</span><span class="p">,</span> <span class="mf">5.9707E+003</span><span class="p">,</span> <span class="mf">5.7070E+003</span><span class="p">,</span> <span class="mf">5.4500E+003</span><span class="p">,</span> <span class="mf">5.2015E+003</span><span class="p">,</span> <span class="mf">4.9588E+003</span><span class="p">,</span> <span class="mf">4.7202E+003</span><span class="p">,</span> <span class="mf">4.4884E+003</span><span class="p">,</span> <span class="mf">4.2577E+003</span><span class="p">,</span> <span class="mf">4.0246E+003</span><span class="p">,</span> <span class="mf">3.7942E+003</span><span class="p">,</span> <span class="mf">3.5664E+003</span><span class="p">,</span> <span class="mf">3.3406E+003</span><span class="p">,</span> <span class="mf">3.1184E+003</span><span class="p">,</span> <span class="mf">2.8977E+003</span><span class="p">,</span> <span class="mf">2.6811E+003</span><span class="p">,</span> <span class="mf">2.4719E+003</span><span class="p">,</span> <span class="mf">2.2663E+003</span><span class="p">,</span> <span class="mf">2.0673E+003</span><span class="p">,</span> <span class="mf">1.8769E+003</span><span class="p">,</span> <span class="mf">1.7017E+003</span><span class="p">,</span> <span class="mf">1.5479E+003</span><span class="p">,</span> <span class="mf">1.4207E+003</span><span class="p">,</span> <span class="mf">1.3304E+003</span><span class="p">,</span> <span class="mf">1.2780E+003</span><span class="p">,</span> <span class="mf">1.2673E+003</span><span class="p">,</span> <span class="mf">1.2761E+003</span><span class="p">])</span>
    <span class="n">nDEL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_DEL</span><span class="p">)</span>
    <span class="n">gamma_fatigue</span> <span class="o">=</span> <span class="mf">1.35</span><span class="o">*</span><span class="mf">1.3</span><span class="o">*</span><span class="mf">1.0</span>
    <span class="n">life</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="n">m_SN</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># ---------------</span>


    <span class="c1"># --- constraints ---</span>
    <span class="n">min_d_to_t</span> <span class="o">=</span> <span class="mf">120.0</span>
    <span class="n">max_taper</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="c1"># ---------------</span>

    <span class="c1"># # V_max = 80.0  # tip speed</span>
    <span class="c1"># # D = 126.0</span>
    <span class="c1"># # .freq1p = V_max / (D/2) / (2*pi)  # convert to Hz</span>

    <span class="n">nPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d_param</span><span class="p">)</span>
    <span class="n">nFull</span>   <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">nPoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">wind</span> <span class="o">=</span> <span class="s1">&#39;PowerWind&#39;</span>
    <span class="n">nLC</span> <span class="o">=</span> <span class="mi">2</span>
    
    <span class="n">prob</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">TowerSE</span><span class="p">(</span><span class="n">nLC</span><span class="p">,</span> <span class="n">nPoints</span><span class="p">,</span> <span class="n">nFull</span><span class="p">,</span> <span class="n">nDEL</span><span class="p">,</span> <span class="n">wind</span><span class="o">=</span><span class="n">wind</span><span class="p">))</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">wind</span><span class="o">==</span><span class="s1">&#39;PowerWind&#39;</span><span class="p">:</span>
        <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind1.shearExp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind2.shearExp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shearExp</span>

    <span class="c1"># assign values to params</span>

    <span class="c1"># --- geometry ----</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;hub_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_param</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;foundation_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_section_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_param</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_outer_diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_param</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_wall_thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_param</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_buckling_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L_reinforced</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_outfitting_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Koutfitting</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;distLoads1.yaw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;distLoads2.yaw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yaw</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;monopile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">monopile</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;suctionpile_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">suction_depth</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;soil_G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soilG</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;soil_nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soilnu</span>
    <span class="c1"># --- material props ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">E</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;material_density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_y</span>

    <span class="c1"># --- extra mass ----</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;rna_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;rna_I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mI</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;rna_cg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mrho</span>
    <span class="c1"># -----------</span>

    <span class="c1"># --- wind &amp; wave ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind1.zref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind2.zref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_zref</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_z0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;cd_usr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cd_usr</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;windLoads1.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;windLoads2.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.225</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;windLoads1.mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;windLoads2.mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.7934e-5</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wave1.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wave2.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;waveLoads1.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;waveLoads2.rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1025.0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;waveLoads1.mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;waveLoads2.mu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.3351e-3</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;windLoads1.beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;windLoads2.beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;waveLoads1.beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;waveLoads2.beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wave1.hmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wave2.hmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmax</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wave1.T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wave2.T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>
    <span class="c1">#prob[&#39;waveLoads1.U0&#39;] = prob[&#39;waveLoads1.A0&#39;] = prob[&#39;waveLoads1.beta0&#39;] = prob[&#39;waveLoads2.U0&#39;] = prob[&#39;waveLoads2.A0&#39;] = prob[&#39;waveLoads2.beta0&#39;] = 0.0</span>
    <span class="c1"># ---------------</span>

    <span class="c1"># --- safety factors ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;gamma_f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_f</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;gamma_m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_m</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;gamma_n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_n</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;gamma_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_b</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;gamma_fatigue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_fatigue</span>
    <span class="c1"># ---------------</span>

    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;DC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">80.0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;shear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;geom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_force_discretization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;nM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;Mmethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;lump&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    
    <span class="c1"># --- fatigue ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_z_DEL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_DEL</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_M_DEL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_DEL</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;life&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">life</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;m_SN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_SN</span>
    <span class="c1"># ---------------</span>

    <span class="c1"># --- constraints ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;min_d_to_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_d_to_t</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;max_taper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_taper</span>
    <span class="c1"># ---------------</span>


    <span class="c1"># # --- loading case 1: max Thrust ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind1.Uref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_Uref1</span>

    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;pre1.rna_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Fx1</span><span class="p">,</span> <span class="n">Fy1</span><span class="p">,</span> <span class="n">Fz1</span><span class="p">])</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;pre1.rna_M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Mxx1</span><span class="p">,</span> <span class="n">Myy1</span><span class="p">,</span> <span class="n">Mzz1</span><span class="p">])</span>
    <span class="c1"># # ---------------</span>


    <span class="c1"># # --- loading case 2: max Wind Speed ---</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind2.Uref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_Uref2</span>

    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;pre2.rna_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Fx2</span><span class="p">,</span> <span class="n">Fy2</span><span class="p">,</span> <span class="n">Fz2</span><span class="p">])</span>
    <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;pre2.rna_M&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Mxx2</span><span class="p">,</span> <span class="n">Myy2</span><span class="p">,</span> <span class="n">Mzz2</span><span class="p">])</span>

    <span class="c1"># # --- run ---</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;z_full&#39;</span><span class="p">]</span>

    <span class="nb">print</span> <span class="s1">&#39;zs=&#39;</span><span class="p">,</span> <span class="n">z</span>
    <span class="nb">print</span> <span class="s1">&#39;ds=&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;d_full&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;ts=&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;t_full&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;mass (kg) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;cg (m) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;weldability =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;weldability&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;manufacturability =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;manufacturability&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">wind: &#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind1.Uref&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;f1 (Hz) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower1.f1&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;top_deflection1 (m) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.top_deflection&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;stress1 =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.stress&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;GL buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.global_buckling&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;Shell buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.shell_buckling&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;damage =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.damage&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">wind: &#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind2.Uref&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;f1 (Hz) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower2.f1&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;top_deflection2 (m) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.top_deflection&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;stress2 =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.stress&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;GL buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.global_buckling&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;Shell buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.shell_buckling&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="s1">&#39;damage =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.damage&#39;</span><span class="p">]</span>


    <span class="n">stress1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.stress&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">shellBuckle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.shell_buckling&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">globalBuckle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.global_buckling&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">damage1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.damage&#39;</span><span class="p">]</span> <span class="p">)</span>

    <span class="n">stress2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.stress&#39;</span><span class="p">]</span>
    <span class="n">shellBuckle2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.shell_buckling&#39;</span><span class="p">]</span>
    <span class="n">globalBuckle2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.global_buckling&#39;</span><span class="p">]</span>
    <span class="n">damage2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.damage&#39;</span><span class="p">]</span>

    
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stress1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stress 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stress2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stress 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shellBuckle1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;shell buckling 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shellBuckle2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;shell buckling 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">globalBuckle1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;global buckling 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">globalBuckle2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;global buckling 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">damage1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;damage 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">damage2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;damage 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;utilization&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;height along tower (m)&#39;</span><span class="p">)</span>

    <span class="c1">#plt.figure(2)</span>
    <span class="c1">#plt.plot(prob[&#39;d_full&#39;]/2.+max(prob[&#39;d_full&#39;]), z, &#39;ok&#39;)</span>
    <span class="c1">#plt.plot(prob[&#39;d_full&#39;]/-2.+max(prob[&#39;d_full&#39;]), z, &#39;ok&#39;)</span>

    <span class="c1">#fig = plt.figure(3)</span>
    <span class="c1">#ax1 = fig.add_subplot(121)</span>
    <span class="c1">#ax2 = fig.add_subplot(122)</span>

    <span class="c1">#ax1.plot(prob[&#39;wind1.U&#39;], z)</span>
    <span class="c1">#ax2.plot(prob[&#39;wind2.U&#39;], z)</span>
    <span class="c1">#plt.tight_layout()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower1.base_F&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower1.base_M&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower2.base_F&#39;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower2.base_M&#39;</span><span class="p">]</span>
    <span class="c1"># ------------</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if optimize:</span>

<span class="sd">        # --- optimizer imports ---</span>
<span class="sd">        from pyopt_driver.pyopt_driver import pyOptDriver</span>
<span class="sd">        from openmdao.lib.casehandlers.api import DumpCaseRecorder</span>
<span class="sd">        # ----------------------</span>

<span class="sd">        # --- Setup Pptimizer ---</span>
<span class="sd">        tower.replace(&#39;driver&#39;, pyOptDriver())</span>
<span class="sd">        tower.driver.optimizer = &#39;SNOPT&#39;</span>
<span class="sd">        tower.driver.options = {&#39;Major feasibility tolerance&#39;: 1e-6,</span>
<span class="sd">                               &#39;Minor feasibility tolerance&#39;: 1e-6,</span>
<span class="sd">                               &#39;Major optimality tolerance&#39;: 1e-5,</span>
<span class="sd">                               &#39;Function precision&#39;: 1e-8}</span>
<span class="sd">        # ----------------------</span>

<span class="sd">        # --- Objective ---</span>
<span class="sd">        tower.driver.add_objective(&#39;tower1.mass / 300000&#39;)</span>
<span class="sd">        # ----------------------</span>

<span class="sd">        # --- Design Variables ---</span>
<span class="sd">        tower.driver.add_parameter(&#39;z_param[1]&#39;, low=0.0, high=87.0)</span>
<span class="sd">        tower.driver.add_parameter(&#39;d_param[:-1]&#39;, low=3.87, high=20.0)</span>
<span class="sd">        tower.driver.add_parameter(&#39;t_param&#39;, low=0.005, high=0.2)</span>
<span class="sd">        # ----------------------</span>

<span class="sd">        # --- recorder ---</span>
<span class="sd">        tower.recorders = [DumpCaseRecorder()]</span>
<span class="sd">        # ----------------------</span>

<span class="sd">        # --- Constraints ---</span>
<span class="sd">        tower.driver.add_constraint(&#39;tower.stress &lt;= 1.0&#39;)</span>
<span class="sd">        tower.driver.add_constraint(&#39;tower.global_buckling &lt;= 1.0&#39;)</span>
<span class="sd">        tower.driver.add_constraint(&#39;tower.shell_buckling &lt;= 1.0&#39;)</span>
<span class="sd">        tower.driver.add_constraint(&#39;tower.damage &lt;= 1.0&#39;)</span>
<span class="sd">        tower.driver.add_constraint(&#39;gc.weldability &lt;= 0.0&#39;)</span>
<span class="sd">        tower.driver.add_constraint(&#39;gc.manufacturability &lt;= 0.0&#39;)</span>
<span class="sd">        freq1p = 0.2  # 1P freq in Hz</span>
<span class="sd">        tower.driver.add_constraint(&#39;tower.f1 &gt;= 1.1*%f&#39; % freq1p)</span>
<span class="sd">        # ----------------------</span>

<span class="sd">        # --- run opt ---</span>
<span class="sd">        tower.run()</span>
<span class="sd">        # ---------------</span>
<span class="sd">    &quot;&quot;&quot;</span>



    
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TowerSE 0.1.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, NREL.
      Last updated on Apr 08, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>