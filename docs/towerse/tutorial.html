
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3. Tutorial &#8212; TowerSE 0.1.4 documentation</title>
    <link rel="stylesheet" href="_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Documentation" href="documentation.html" />
    <link rel="prev" title="2. Installation" href="installation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4. Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="2. Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TowerSE 0.1.4 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<span id="tutorial-label"></span><h1>3. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>Two examples are included in this tutorial section: simulation of a land-based tower, and optimization of a land-based tower.</p>
<div class="section" id="land-based-tower-simulation">
<h2>3.1. Land-based Tower Simulation<a class="headerlink" href="#land-based-tower-simulation" title="Permalink to this headline">¶</a></h2>
<p>This following example demonstrates how to setup and run <em>analysis</em> for a land-based tower.  First, we import the modules we want to use and setup the tower configuration.  <cite>TowerSE</cite> was designed to be modular, and so the specific modules you wish to use in the analysis must be specified. There are <a class="reference external" href="http://openmdao.org/docs/basics/variables.html#slot-variables">OpenMDAO Slots</a> for wind1, wind2, wave1, wave2, soil, tower1, and tower2.  The first five make use of the commonse.environment module.  We use multiple wind/wave/tower modules because we are considering two separate loading conditions in this simulation.  The slots wind1 and wind2 can be any component that inherits from <a class="reference internal" href="documentation.html#commonse.environment.WindBase" title="commonse.environment.WindBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">WindBase</span></code></a>, wave1 and wave2 require components that inherit from <a class="reference internal" href="documentation.html#commonse.environment.WaveBase" title="commonse.environment.WaveBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveBase</span></code></a>, and soil uses components that inherit from <a class="reference internal" href="documentation.html#commonse.environment.SoilBase" title="commonse.environment.SoilBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SoilBase</span></code></a>.</p>
<p>In this case we are using <a class="reference internal" href="documentation.html#commonse.environment.PowerWind" title="commonse.environment.PowerWind"><code class="xref py py-class docutils literal notranslate"><span class="pre">PowerWind</span></code></a>, which defines a power-profile for the wind distribution.  A component, <a class="reference internal" href="documentation.html#commonse.environment.LogWind" title="commonse.environment.LogWind"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogWind</span></code></a> for a logarithmic profile is also available.  We are simulating a land-based turbine so we do not load any wave modules.  The default <a class="reference internal" href="documentation.html#commonse.environment.WaveBase" title="commonse.environment.WaveBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveBase</span></code></a> module is for no wave loading.  A <a class="reference internal" href="documentation.html#commonse.environment.LinearWaves" title="commonse.environment.LinearWaves"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearWaves</span></code></a> component is available which uses linear wave theory.  A simple textbook-based soil model is provided at <a class="reference internal" href="documentation.html#commonse.environment.TowerSoil" title="commonse.environment.TowerSoil"><code class="xref py py-class docutils literal notranslate"><span class="pre">TowerSoil</span></code></a>.  For all slots, users may define any custom component as desired.</p>
<p>Tor tower1 and tower2, the module uses the frame finite element code <a class="reference external" href="http://frame3dd.sourceforge.net/">Frame3DD</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="kn">import</span> <span class="n">PowerWind</span>
    <span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="kn">import</span> <span class="n">LogWind</span>

</pre></div>
</div>
<p>With the tower configuration setup, we define some of the geometric parameters.  Some of the geometric parameters are seen in <a class="pageref" href="#tower-fig">Figure  1</a>.  The tower is not restricted to 3 sections, any number of sections can be defined.  The array <cite>z</cite> is given in coordinates nondimensionalized by the tower height.  The array <cite>n</cite>, should of length len(tower.z)-1 and represents the number of finite elements to be used in each tower can.  The float <cite>L_reinforced</cite> is a reinforcement length used in the buckling calculations.  Yaw and tilt are needed to handle to mass/load transfer.  For offshore applications, monopile geometry can also be defined (see <a class="reference internal" href="documentation.html#towerse.tower.TowerSE" title="towerse.tower.TowerSE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TowerSE</span></code></a>).</p>
<div class="figure align-center" id="id1">
<span id="tower-fig"></span><a class="reference internal image-reference" href="_images/tower.png"><img alt="_images/tower.png" src="_images/tower.png" style="height: 4in;" /></a>
<p class="caption"><span class="caption-text">Figure 1: Example of tower geometric parameterization.</span></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">h_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">43.8</span><span class="p">,</span> <span class="mf">87.6</span><span class="p">]))</span>
    <span class="n">d_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.935</span><span class="p">,</span> <span class="mf">3.87</span><span class="p">])</span>
    <span class="n">t_param</span> <span class="o">=</span> <span class="mf">1.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.021</span><span class="p">])</span>
    <span class="n">z_foundation</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">L_reinforced</span> <span class="o">=</span> <span class="mf">30.0</span>  <span class="c1"># [m] buckling length</span>
    <span class="n">theta_stress</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">Koutfitting</span> <span class="o">=</span> <span class="mf">1.07</span>

</pre></div>
</div>
<p>We now define the mass properties for the rotor-nacelle-assembly.  The center of mass locations are defined relative to the tower top in the yaw-aligned coordinate system.  Blade and hub moments of inertia should be defined about the hub center, nacelle moments of inertia are defined about the center of mass of the nacelle.</p>
<p>Environmental properties are defined below, note that the parameters that need to be defined depend on which modules were loaded.  For the power-law wind profile, the only parameter needed is the shear exponent.  For the soil, shear and modulus properties for the soil can be defined, but in this example we assume that all directions are rigid (3 translation and 3 rotation).  In addition, some geometric parameters for the wind profile’s extend must be defined, the base (or no-slip location) at <cite>z0</cite>, and the height at which a reference velocity will be defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">wind_zref</span> <span class="o">=</span> <span class="mf">90.0</span>
    <span class="n">wind_z0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">cd_usr</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>As mentioned earlier, we are allowing for two separate loading cases.  The wind speed, and rotor force/moments for those two cases are now defined.  The wind speed location corresponds to the reference height defined previously as <cite>wind_zref</cite>.  In this simple case, we include only thrust and torque, but in general all 3 components of force and moments can be defined in the hub-aligned coordinate system.  The assembly automatically handles translating the forces and moments defined at the rotor to the tower top.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">wind_Uref1</span> <span class="o">=</span> <span class="mf">11.73732</span>
    <span class="n">Fx1</span> <span class="o">=</span> <span class="mf">1284744.19620519</span>
    <span class="n">Fy1</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Fz1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2914124.84400512</span>
    <span class="n">Mxx1</span> <span class="o">=</span> <span class="mf">3963732.76208099</span>
    <span class="n">Myy1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2275104.79420872</span>
    <span class="n">Mzz1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">346781.68192839</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">wind_Uref2</span> <span class="o">=</span> <span class="mf">70.0</span>
    <span class="n">Fx2</span> <span class="o">=</span> <span class="mf">930198.60063279</span>
    <span class="n">Fy2</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Fz2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2883106.12368949</span>
    <span class="n">Mxx2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1683669.22411597</span>
    <span class="n">Myy2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2522475.34625363</span>
    <span class="n">Mzz2</span> <span class="o">=</span> <span class="mf">147301.97023764</span>
</pre></div>
</div>
<p>Safety factors for loading, material, consequence of failure, and buckling are defined</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">gamma_f</span> <span class="o">=</span> <span class="mf">1.35</span>
    <span class="n">gamma_m</span> <span class="o">=</span> <span class="mf">1.3</span>
    <span class="n">gamma_n</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">gamma_b</span> <span class="o">=</span> <span class="mf">1.1</span>
</pre></div>
</div>
<p>A simplified fatigue analysis is available for the tower.  This requires running an aeroelastic code, like FAST, before hand and inputing the damage equivalent moments.  The locations of the moments are given on a nondimensional tower.  A safety factor, lifetime (in years), and slope of the S-N curve can be defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">z_DEL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">1.327</span><span class="p">,</span> <span class="mf">3.982</span><span class="p">,</span> <span class="mf">6.636</span><span class="p">,</span> <span class="mf">9.291</span><span class="p">,</span> <span class="mf">11.945</span><span class="p">,</span> <span class="mf">14.600</span><span class="p">,</span> <span class="mf">17.255</span><span class="p">,</span> <span class="mf">19.909</span><span class="p">,</span> <span class="mf">22.564</span><span class="p">,</span> <span class="mf">25.218</span><span class="p">,</span> <span class="mf">27.873</span><span class="p">,</span> <span class="mf">30.527</span><span class="p">,</span> <span class="mf">33.182</span><span class="p">,</span> <span class="mf">35.836</span><span class="p">,</span> <span class="mf">38.491</span><span class="p">,</span> <span class="mf">41.145</span><span class="p">,</span> <span class="mf">43.800</span><span class="p">,</span> <span class="mf">46.455</span><span class="p">,</span> <span class="mf">49.109</span><span class="p">,</span> <span class="mf">51.764</span><span class="p">,</span> <span class="mf">54.418</span><span class="p">,</span> <span class="mf">57.073</span><span class="p">,</span> <span class="mf">59.727</span><span class="p">,</span> <span class="mf">62.382</span><span class="p">,</span> <span class="mf">65.036</span><span class="p">,</span> <span class="mf">67.691</span><span class="p">,</span> <span class="mf">70.345</span><span class="p">,</span> <span class="mf">73.000</span><span class="p">,</span> <span class="mf">75.655</span><span class="p">,</span> <span class="mf">78.309</span><span class="p">,</span> <span class="mf">80.964</span><span class="p">,</span> <span class="mf">83.618</span><span class="p">,</span> <span class="mf">86.273</span><span class="p">,</span> <span class="mf">87.600</span><span class="p">])</span>
    <span class="n">M_DEL</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">8.2940E+003</span><span class="p">,</span> <span class="mf">8.1518E+003</span><span class="p">,</span> <span class="mf">7.8831E+003</span><span class="p">,</span> <span class="mf">7.6099E+003</span><span class="p">,</span> <span class="mf">7.3359E+003</span><span class="p">,</span> <span class="mf">7.0577E+003</span><span class="p">,</span> <span class="mf">6.7821E+003</span><span class="p">,</span> <span class="mf">6.5119E+003</span><span class="p">,</span> <span class="mf">6.2391E+003</span><span class="p">,</span> <span class="mf">5.9707E+003</span><span class="p">,</span> <span class="mf">5.7070E+003</span><span class="p">,</span> <span class="mf">5.4500E+003</span><span class="p">,</span> <span class="mf">5.2015E+003</span><span class="p">,</span> <span class="mf">4.9588E+003</span><span class="p">,</span> <span class="mf">4.7202E+003</span><span class="p">,</span> <span class="mf">4.4884E+003</span><span class="p">,</span> <span class="mf">4.2577E+003</span><span class="p">,</span> <span class="mf">4.0246E+003</span><span class="p">,</span> <span class="mf">3.7942E+003</span><span class="p">,</span> <span class="mf">3.5664E+003</span><span class="p">,</span> <span class="mf">3.3406E+003</span><span class="p">,</span> <span class="mf">3.1184E+003</span><span class="p">,</span> <span class="mf">2.8977E+003</span><span class="p">,</span> <span class="mf">2.6811E+003</span><span class="p">,</span> <span class="mf">2.4719E+003</span><span class="p">,</span> <span class="mf">2.2663E+003</span><span class="p">,</span> <span class="mf">2.0673E+003</span><span class="p">,</span> <span class="mf">1.8769E+003</span><span class="p">,</span> <span class="mf">1.7017E+003</span><span class="p">,</span> <span class="mf">1.5479E+003</span><span class="p">,</span> <span class="mf">1.4207E+003</span><span class="p">,</span> <span class="mf">1.3304E+003</span><span class="p">,</span> <span class="mf">1.2780E+003</span><span class="p">,</span> <span class="mf">1.2673E+003</span><span class="p">,</span> <span class="mf">1.2761E+003</span><span class="p">])</span>
    <span class="n">nDEL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_DEL</span><span class="p">)</span>
    <span class="n">gamma_fatigue</span> <span class="o">=</span> <span class="mf">1.35</span><span class="o">*</span><span class="mf">1.3</span><span class="o">*</span><span class="mf">1.0</span>
    <span class="n">life</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="n">m_SN</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Finally, some additional parameters used for constraints can be defined.  These include the minimum allowable taper ratio of the tower (from base to top), and the minimum diameter-to-thickness ratio allowed at any section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">min_d_to_t</span>   <span class="o">=</span> <span class="mf">120.0</span>
    <span class="n">max_taper</span>    <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">hub_cm</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">5.01910</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.96256</span><span class="p">])</span>
    <span class="n">tip_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.9315</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">27.5</span><span class="p">])</span>
    <span class="n">downwind</span>     <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>In the folllowing specification, we used the default values for wind density and viscosity, material properties (for steel), and acceleration of gravity.  By examining, <a class="reference internal" href="documentation.html#towerse.tower.TowerSE" title="towerse.tower.TowerSE"><code class="xref py py-class docutils literal notranslate"><span class="pre">TowerSE</span></code></a> the user can see all possible parameters and their defaults.  We can now run the assembly and display some of the outputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">prob</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">z</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">nodal2sectional</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s1">&#39;z_full&#39;</span><span class="p">])</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;zs=&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;ds=&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;d_full&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;ts=&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;t_full&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;mass (kg) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_mass&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;cg (m) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower_center_of_mass&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;weldability =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;weldability&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;manufacturability =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;manufacturability&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">wind: &#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind1.Uref&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;f1 (Hz) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower1.f1&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;top_deflection1 (m) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.top_deflection&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;stress1 =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.stress&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;GL buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.global_buckling&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Shell buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.shell_buckling&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;damage =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.damage&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">wind: &#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;wind2.Uref&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;f1 (Hz) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower2.f1&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;top_deflection2 (m) =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.top_deflection&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;stress2 =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.stress&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;GL buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.global_buckling&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Shell buckling =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.shell_buckling&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;damage =&#39;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.damage&#39;</span><span class="p">])</span>


    <span class="n">stress1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.stress&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">shellBuckle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.shell_buckling&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">globalBuckle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.global_buckling&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">damage1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post1.damage&#39;</span><span class="p">]</span> <span class="p">)</span>

    <span class="n">stress2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.stress&#39;</span><span class="p">]</span>
    <span class="n">shellBuckle2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.shell_buckling&#39;</span><span class="p">]</span>
    <span class="n">globalBuckle2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.global_buckling&#39;</span><span class="p">]</span>
    <span class="n">damage2</span> <span class="o">=</span> <span class="n">prob</span><span class="p">[</span><span class="s1">&#39;post2.damage&#39;</span><span class="p">]</span>

    
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stress1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stress 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stress2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stress 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shellBuckle1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;shell buckling 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shellBuckle2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;shell buckling 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">globalBuckle1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;global buckling 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">globalBuckle2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;global buckling 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">damage1</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;damage 1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">damage2</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;damage 2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;utilization&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;height along tower (m)&#39;</span><span class="p">)</span>

    <span class="c1">#plt.figure(2)</span>
    <span class="c1">#plt.plot(prob[&#39;d_full&#39;]/2.+max(prob[&#39;d_full&#39;]), z, &#39;ok&#39;)</span>
    <span class="c1">#plt.plot(prob[&#39;d_full&#39;]/-2.+max(prob[&#39;d_full&#39;]), z, &#39;ok&#39;)</span>

    <span class="c1">#fig = plt.figure(3)</span>
    <span class="c1">#ax1 = fig.add_subplot(121)</span>
    <span class="c1">#ax2 = fig.add_subplot(122)</span>

    <span class="c1">#ax1.plot(prob[&#39;wind1.U&#39;], z)</span>
    <span class="c1">#ax2.plot(prob[&#39;wind2.U&#39;], z)</span>
    <span class="c1">#plt.tight_layout()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower1.base_F&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower1.base_M&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower2.base_F&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s1">&#39;tower2.base_M&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The resuling output is shown below.  The outputs f1 and f2 and the first two natural frequencies.  The outputs top_deflection are the deflection of the tower top in the yaw-aligned +x direction for the two loading cases.  Weldability is an array of outputs that should be &lt;0 for feasibility.  They represent margin against the minimum diameter-to-thickness ratio.  Manufacturability represents margin against the minimum taper ratio and should be &lt;0 for feasibility.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mass</span> <span class="p">(</span><span class="n">kg</span><span class="p">)</span> <span class="o">=</span> <span class="mf">349486.79362</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span> <span class="p">(</span><span class="n">Hz</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.331531844509</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span> <span class="p">(</span><span class="n">Hz</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.334804545737</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_deflection1</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.691606748192</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top_deflection2</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.708610880714</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weldability</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.42450142</span> <span class="o">-</span><span class="mf">0.37541806</span> <span class="o">-</span><span class="mf">0.30566802</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">manufactuability</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.245</span>
</pre></div>
</div>
<p>The stress, bucklng, and damage loads are shown in <a class="pageref" href="#utilization-fig">Figure  2</a>.  Each is a utilization and so should be &lt;1 for feasibility.</p>
<div class="figure align-center" id="id2">
<span id="utilization-fig"></span><a class="reference internal image-reference" href="_images/utilization.png"><img alt="_images/utilization.png" src="_images/utilization.png" style="width: 6in;" /></a>
<p class="caption"><span class="caption-text">Figure 2: Utilization along tower for ultimate stress, shell buckling, global buckling, and fatigue damage.</span></p>
</div>
</div>
<div class="section" id="land-based-tower-optimization">
<h2>3.2. Land-Based Tower Optimization<a class="headerlink" href="#land-based-tower-optimization" title="Permalink to this headline">¶</a></h2>
<p>We begin with the same setup as the previous section, but now import additional modules for optimization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="kn">from</span> <span class="nn">pyopt_driver.pyopt_driver</span> <span class="kn">import</span> <span class="n">pyOptDriver</span>
        <span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">DumpCaseRecorder</span>
</pre></div>
</div>
<p>The optimizer must first be selected and configured, in this example I use SNOPT.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">tower</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;driver&#39;</span><span class="p">,</span> <span class="n">pyOptDriver</span><span class="p">())</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s1">&#39;SNOPT&#39;</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Major feasibility tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                               <span class="s1">&#39;Minor feasibility tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                               <span class="s1">&#39;Major optimality tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
                               <span class="s1">&#39;Function precision&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">}</span>
</pre></div>
</div>
<p>We now set the objective, and in this example it is normalized to be of order 1 for better convergence behavior.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s1">&#39;tower1.mass / 300000&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The tower diameters, thickness, and waist location are added as design variables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;z_param[1]&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">87.0</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;d_param[:-1]&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">3.87</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;t_param&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<p>A recorder is added to display each iteration to the screen.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">tower</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">DumpCaseRecorder</span><span class="p">()]</span>
</pre></div>
</div>
<p>Finally, constraints are added.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;tower.stress &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;tower.global_buckling &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;tower.shell_buckling &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;tower.damage &lt;= 1.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;gc.weldability &lt;= 0.0&#39;</span><span class="p">)</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;gc.manufacturability &lt;= 0.0&#39;</span><span class="p">)</span>
        <span class="n">freq1p</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># 1P freq in Hz</span>
        <span class="n">tower</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s1">&#39;tower.f1 &gt;= 1.1*</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">freq1p</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the optimization can be run.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">tower</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Tutorial</a><ul>
<li><a class="reference internal" href="#land-based-tower-simulation">3.1. Land-based Tower Simulation</a></li>
<li><a class="reference internal" href="#land-based-tower-optimization">3.2. Land-Based Tower Optimization</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">2. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="documentation.html"
                        title="next chapter">4. Documentation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4. Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="2. Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">TowerSE 0.1.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, NREL.
      Last updated on Apr 08, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>